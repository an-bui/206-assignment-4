---
title: "Assignment 4 Report"
author: "An Bui"
date: "11/10/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r set up libraries and data, include = FALSE}
# load packages
library(tidyverse)
library(vcdExtra)
library(kableExtra)

# read in .csv and get in tidy format
abund_master <- read_csv("lobster_size_abundance.csv")
abund <- as.data.frame(abund_master) %>% 
  expand.dft(freq = "COUNT")

traps_master <- read_csv("lobster_traps.csv")
traps <- as.data.frame(traps_master) %>% 
  expand.dft(freq = "TRAPS")
```

#### Ideas:  
1. box and whisker for abundance and fishing pressure (because sample size is so big that median is probably a better indicator of central value than mean)? or jitter?  
2. table of mean lobster sizes (or box and whisker? code below)
3. At Isla Vista and Naples Reef, the two protected MPA sites (with zero fishing pressure), how do lobster sizes
in 2012 and 2017 compare? At the non-MPA sites? -> t-test for IVEE and NAPL, ANOVA for AQUE, MOHK, CARP
4. What proportion of observed lobsters at each site are above the legal minimum? Does that proportion differ significantly across the 5 sites? -> chi square

##### 0. exploratory things
```{r summary table, include = FALSE}
abund_table <- abund %>% 
  group_by(SITE) %>% 
  summarize(
    mean_size = mean(SIZE),
    median_size = median(SIZE),
    count = length(SIZE)
  )

abund_table

trap_table <- traps %>% 
  group_by(SITE) %>% 
  filter(SITE == "IVEE" | SITE == "NAPL" | SITE == "AQUE" | SITE == "MOHK" | SITE == "CARP") %>% 
  summarize(
    count = length(SITE)
  )

trap_table
## no surveys at IVEE or NAPL???? am I doing this wrong??
```

##### 1. code for random shit
```{r abundance histogram, include = FALSE}
# just wanted to see what this looked like
abund_hist <- ggplot(abund, aes(x = SIZE)) +
  geom_histogram() +
  facet_wrap(~ SITE)

abund_hist
```

```{r box and whisker of size by site, include = FALSE}
abund_size_box <- ggplot(abund, aes(x = SITE, y = SIZE)) +
  geom_boxplot()

abund_size_box
```

```{r box and whisker of abundance by site, include = FALSE}
abund_master_clean <- abund_master %>% 
  filter(SIZE != "-99999")
# because ?

abund_count_box <- ggplot(abund_master_clean, aes(x = SITE, y = COUNT)) +
  geom_boxplot()

abund_count_box
# ok so probably not a box and whisker 
```

```{r jitter of abundance by site, include = FALSE}
abund_count_jitter <- ggplot(abund_master_clean, aes(x = YEAR, y = COUNT)) +
  geom_jitter() +
  facet_wrap(~ SITE)

abund_count_jitter
```

##### 2. stats n shit
```{r summary table, include = FALSE}
# Are mean lobster sizes significantly different in 2012 and 2017 for IVEE? For NAPL?
# H0: means are not significantly different in 2012 and 2017 for IVEE/NAPL.
# HA: means are significantly different in 2012 and 2017 for IVEE/NAPL.

# 1. establish normality: is 2012 IVEE/2017 IVEE and 2012 NAPL/2017 NAPL data normal?
# 2. test for equal variances
# 3. run a t-test

abund_IVEE <- abund %>% 
  filter(YEAR == "2012" | YEAR == "2017",
         SITE == "IVEE")

abund_NAPL <- abund %>% 
  filter(YEAR == "2012" | YEAR == "2017",
         SITE == "NAPL")

abund_both <- abund %>% 
  filter(YEAR == "2012" | YEAR == "2017",
         SITE == "IVEE" | SITE == "NAPL")

abund_IVEE_table <- abund_IVEE %>% 
  group_by(YEAR) %>% 
  summarize(
    mean_size = mean(SIZE),
    median_size = median(SIZE),
    sd_size = sd(SIZE),
    sample_size = length(SIZE)
  )

abund_NAPL_table <- abund_NAPL %>% 
  group_by(YEAR) %>% 
  summarize(
    mean_size = mean(SIZE),
    median_size = median(SIZE),
    sd_size = sd(SIZE),
    sample_size = length(SIZE)
  )

abund_IVEE_table
abund_NAPL_table
# way more 2017 observations than 2012, is that a problem?
```

```{r size qqplots, include = FALSE}
size_qq_IVEE <- ggplot(abund_IVEE, aes(sample = SIZE)) +
  geom_qq() +
  facet_wrap(~ YEAR)

size_qq_NAPL <- ggplot(abund_NAPL, aes(sample = SIZE)) +
  geom_qq() +
  facet_wrap(~ YEAR)
  
size_qq_IVEE
size_qq_NAPL
# not normally distributed
```

```{r size histograms, include = FALSE}
size_hist_IVEE <- ggplot(abund_IVEE, aes(x = SIZE)) +
  geom_histogram(bins = 17)

size_hist_NAPL <- ggplot(abund_2012, aes(x = SIZE)) +
  geom_histogram(bins = 10)

size_hist_IVEE
size_hist_NAPL
# not normally distributed
```

```{r test for equal variances, include = FALSE}
size_IVEE_2012 <- abund %>%
  filter(SITE == "IVEE",
         YEAR == "2012") %>% 
  pull(SIZE)

size_IVEE_2017 <- abund %>% 
  filter(SITE == "IVEE",
         YEAR == "2012") %>% 
  pull(SIZE)

size_NAPL_2012 <- abund %>%
  filter(SITE == "NAPL",
         YEAR == "2012") %>% 
  pull(SIZE)

size_NAPL_2017 <- abund %>% 
  filter(SITE == "NAPL",
         YEAR == "2017") %>% 
  pull(SIZE)

IVEE_var <- var.test(size_IVEE_2012, size_IVEE_2017)
IVEE_var
# what does p-value of 1 mean???
NAPL_var <- var.test(size_NAPL_2012, size_IVEE_2017)
NAPL_var
# p value 0.9406, variances are equal
```
```{r t-test, include = FALSE}
# this is just for NAPL because idk what is going on with IVEE
NAPL_t <- t.test(size_NAPL_2012, size_NAPL_2017)
NAPL_t
# p value = 0.5373, lob means are not significantly different between 2012 and 2017 at NAPL
```



